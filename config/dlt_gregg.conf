# shellcheck shell=bash
# shellcheck disable=SC2034

# Enhanced Research-Based Configuration with Brendan Gregg Integration
WARMUP_ITERATIONS=50
RAMPUP_ITERATIONS=100
SUSTAINED_ITERATIONS=850
TOTAL_ITERATIONS=1000

# Apache Bench Parameters
AB_REQUESTS=1000
AB_CONCURRENCY=50
THINK_TIME_MS=2000
TEST_TIMEOUT=30

# Test scenarios
declare -A SCENARIOS=(
    ["DYNAMIC"]="http://myblog.local/post/3/visiting-bali-a-journey-of-serenity-and-culture"
    ["STATIC"]="http://myblog.local/login"
    ["404_ERROR"]="http://myblog.local/this-is-not-real-page"
)

# Brendan Gregg's Enhanced Configuration
# System Profiling Controls
ENABLE_GREGG_PROFILING=${ENABLE_GREGG_PROFILING:-true}
ENABLE_KERNEL_METRICS=${ENABLE_KERNEL_METRICS:-true}
ENABLE_FLAME_GRAPHS=${ENABLE_FLAME_GRAPHS:-true}
ENABLE_NETWORK_ANALYSIS=${ENABLE_NETWORK_ANALYSIS:-true}
ENABLE_IO_ANALYSIS=${ENABLE_IO_ANALYSIS:-true}

# Target Application Configuration
TARGET_APP_PID=${TARGET_APP_PID:-""}  # Set automatically or manually
TARGET_INTERFACE=${TARGET_INTERFACE:-"eth0"}

# Profiling Intervals (Gregg's recommendations)
SYSTEM_METRICS_INTERVAL=${SYSTEM_METRICS_INTERVAL:-1}  # seconds
KERNEL_METRICS_INTERVAL=${KERNEL_METRICS_INTERVAL:-1}
NETWORK_METRICS_INTERVAL=${NETWORK_METRICS_INTERVAL:-2}
IO_METRICS_INTERVAL=${IO_METRICS_INTERVAL:-1}

# Performance Tooling Paths
PERF_BIN=${PERF_BIN:-"perf"}
BPFTRACE_BIN=${BPFTRACE_BIN:-"bpftrace"}
TCPDUMP_BIN=${TCPDUMP_BIN:-"tcpdump"}
IOTOP_BIN=${IOTOP_BIN:-"iotop"}

# Statistics
CONF_Z=1.96

# Tooling
AB_BIN=ab
REPORT_ROOT=./load_test_reports

# Gregg's Advanced Analysis Options
ENABLE_CPU_PROFILING=${ENABLE_CPU_PROFILING:-true}
ENABLE_MEMORY_PROFILING=${ENABLE_MEMORY_PROFILING:-true}
ENABLE_TCP_PROFILING=${ENABLE_TCP_PROFILING:-true}
ENABLE_BLOCK_IO_PROFILING=${ENABLE_BLOCK_IO_PROFILING:-true}

# Flame Graph Configuration
FLAME_GRAPH_DURATION=${FLAME_GRAPH_DURATION:-30}  # seconds
FLAME_GRAPH_FREQUENCY=${FLAME_GRAPH_FREQUENCY:-99}  # Hz

# Container/Cloud Support (if running in containers)
ENABLE_CONTAINER_METRICS=${ENABLE_CONTAINER_METRICS:-false}
CONTAINER_RUNTIME=${CONTAINER_RUNTIME:-"docker"}  # docker, podman, kubernetes
TARGET_CONTAINER_ID=${TARGET_CONTAINER_ID:-""}

# Security and Permissions
REQUIRE_ROOT_FOR_PROFILING=${REQUIRE_ROOT_FOR_PROFILING:-true}
DROP_PRIVILEGES_AFTER_SETUP=${DROP_PRIVILEGES_AFTER_SETUP:-false}

# Output Directories for Gregg's Tools
GREGG_OUTPUT_DIR=${GREGG_OUTPUT_DIR:-"gregg_analysis"}
KERNEL_OUTPUT_DIR=${KERNEL_OUTPUT_DIR:-"kernel_metrics"}
FLAMEGRAPH_DIR=${FLAMEGRAPH_DIR:-"flamegraphs"}

# Advanced Analysis Controls
ENABLE_EBPF_TRACING=${ENABLE_EBPF_TRACING:-true}
ENABLE_PERF_EVENTS=${ENABLE_PERF_EVENTS:-true}
ENABLE_SYSTEM_TAP=${ENABLE_SYSTEM_TAP:-false}  # Alternative to eBPF if available